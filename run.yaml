---
  - hosts: mediaserver
    vars_files:
      - 'vars/vault.yaml'
    roles:
      - role: grog.package
      - role: geerlingguy.docker
      - role: geerlingguy.pip
      - role: sprat.mergerfs
        tags:
          - disks
          - mergerfs
      - role: media_server_init
      - role: telegraf
        tags:
          - telegraf
      # - role: rossmcdonald.telegraf
      #   tags:
      #     - telegraf
    tasks:
      - name: remove ubuntu motd spam
        become: true
        file:
          path: "/etc/update-motd.d/{{ item }}"
          state: absent
        loop:
          - 80-livepatch
          - 95-hwe-eol
          - 10-help-text
        when: ansible_distribution == 'Ubuntu'

      - name: copy over telegraf conf file
        copy:
          src: telegraf.conf
          dest: /etc/telegraf/telegraf.conf
          owner: telegraf
          group: telegraf
        tags:
          - telegraf